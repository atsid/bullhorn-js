define("bullhorn/Channel",[],function(){return function(){this.recreate=function(e){throw new Error("Channel.recreate Not Implemented")},this.publish=function(e,t){throw new Error("Channel.publish Not Implemented")},this.subscribe=function(e,t,n){throw new Error("Channel.subscribe Not Implemented")},this.subscribeOnce=function(e,t,n){throw new Error("Channel.subscribeOnce Not Implemented")},this.unsubscribe=function(e){throw new Error("Channel.unsubscribe Not Implemented")}}}),define("bullhorn/Logger",[],function(){return function(e,t,n){var r={TRACE:1,DEBUG:2,INFO:3,WARN:4,ERROR:5},i,s=[];e=r[e.toUpperCase()],t||(t=console),typeof n=="undefined"&&(n=""),i=function(e,r,i,o,u){var a=t[e]||t.info;r=n+r;if(o)i?a.call(t,r+" --> "+JSON.stringify(i)):a.call(t,r);else try{u[0]&&(u[0]=n+u[0]),a.apply(t,u)}catch(f){a(r,i,o,u)}s.forEach(function(t){t.log(e,r,i,o)})},this.addPlugin=function(e){s.push(e)},this.trace=function(t,n,s){e<=r.TRACE&&i("debug",t,n,s,arguments)},this.debug=function(t,n,s){e<=r.DEBUG&&i("debug",t,n,s,arguments)},this.info=function(t,n,s){e<=r.INFO&&i("info",t,n,s,arguments)},this.warn=function(t,n,s){e<=r.WARN&&i("warn",t,n,s,arguments)},this.error=function(t,n,s){e<=r.ERROR&&i("error",t,n,s,arguments)},this.time=function(e){t.time.apply(t,arguments)},this.timeEnd=function(e){t.timeEnd.apply(t,arguments)}}}),define("bullhorn/log",["./Logger","module"],function(e,t){var n=t.config(),r=n&&n.logLevel;return new e(r||"warn")}),define("bullhorn/Validator",[],function(){return function(){this.validate=function(e,t,n,r){return{valid:!0}}}}),define("bullhorn/uuid",[],function(){return function(){return(new Date).valueOf()+"-"+Math.random()}}),define("bullhorn/CoreApi",["./log","./Validator","./uuid"],function(e,t,n){var r=new t;return function(t){t=t||{};var i={busHash:{},setMessageBus:function(e,t){this.busHash[e]=t},getMessageBus:function(e){var t=this.busHash[e];return t||(t={},this.setMessageBus(e,t)),t},setHandlers:function(e,t,n){this.getMessageBus(e)[t]=n},getHandlers:function(e,t){var n=this.getMessageBus(e)[t];return n||(n=[],this.setHandlers(e,t,n)),n},cropHandlers:function(e,t,n){var r=this.getHandlers(e,t);r=r.filter(function(e){return n(e)}),this.setHandlers(e,t,r)},unsubscribe:function(e,t,n,r){this.cropHandlers(e,t,function(e){return r?e.h!==r:e.cs!==n})}};this.config=t,this.validatingPublish=function(t,n,i,s,o){var u=this.config.resolve(n);e.debug("Validating message for channel ["+n+"]",i),r.validate(i,u,!1),this.nonValidatingPublish(t,n,i,s,o)},this.nonValidatingPublish=function(t,n,r,s,o){var u=i.getHandlers(t,n);u.some(function(s){var u=!0,a;e.debug("Checking message for handler in scope ["+s.cs+"]"),typeof s.fp=="function"&&(u=s.fp.call(s.cs,r));if(u&&(s.cs!==o||s.csp===!0))return e.debug("Message passed filter and scope checks. Publishing now to callback.",r),a=s.fn.call(s.cs,r),typeof a!="boolean"&&(a=!1),s.uah===!0&&(e.debug("unsubscribeAfterHandle was true so unsubscribing from scope ["+s.cs+"] and id ["+s.h+"]"),i.unsubscribe(t,n,s.cs,s.h)),a}),typeof s=="function"&&(e.debug("Completion callback present, calling now for message",r),s.call(o))},this.publish=this.nonValidatingPublish,this.subscribe=function(t,r,s,o,u,a,f){var l=n(),c=i.getHandlers(t,r);return e.debug("Subscribing to channel ["+r+"] on bus ["+t+"] with scope ["+o+"], subscription id: "+l),c.push({fn:s,fp:u,cs:o,h:l,csp:a,uah:f}),l},this.unsubscribe=function(t,n,r,s){e.debug("Unsubscribing from channel ["+n+"] on bus ["+t+"] with scope ["+r+"], with id: "+s),i.unsubscribe(t,n,r,s)},this.isValidating=function(){return this.publish===this.validatingPublish},this.validate=function(t){t===!0?(e.info("Turning schema validation on"),this.publish=this.validatingPublish):(e.info("Turning schema validation off"),this.publish=this.nonValidatingPublish)},this.validate(t.validate)}}),define("bullhorn/ChannelFactory",["./Channel","./CoreApi","./uuid","./log"],function(e,t,n,r){return function(i){function s(e,t){this.unsubscribe=function(){e.unsubscribe(t)}}i=i||{};var o=function(e,t,r,i,o){e.handle=n(),e.schema=t,e.channelName=t.id,e.recreate=function(e){return i.get(t,e,o)},e.publish=function(t,n){i.coreapi.publish(o,e.channelName,t,n,r)},e.unsubscribe=function(t){typeof t=="object"?t.unsubscribe():i.coreapi.unsubscribe(o,e.channelName,r,t)},e.subscribe=function(t,n,u){var a=i.coreapi.subscribe(o,e.channelName,t,r,n,u);return new s(e,a)},e.subscribeOnce=function(t,n,u){var a=i.coreapi.subscribe(o,e.channelName,t,r,n,u,!0);return new s(e,a)}},u=[function(e){if(typeof e=="object")return e}];i.resolver&&u.push(i.resolver),this.resolveSchema=function(e){var t;return u.some(function(n){return t=n(e),t},this),t},this.coreapi=new t({resolve:this.resolveSchema,validate:i.validate}),this.addResolver=function(e){u.push(e)},this.get=function(t,n,i){var s,u;return typeof i=="undefined"&&(i="global"),s=this.resolveSchema(t),r.debug("Getting channel "+s.id+" on bus "+i+" with scope "+n),u=new e,o(u,s,n,this,i),u},this.validate=function(e){r.info("Turning validation on: "+e),this.coreapi.validate(e)}}});